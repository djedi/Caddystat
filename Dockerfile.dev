FROM golang:1.25-alpine AS dev

# Install Node.js and Air (Go live reload)
RUN apk add --no-cache nodejs npm curl && \
    npm install -g http-server && \
    go install github.com/air-verse/air@latest

WORKDIR /app
COPY go.mod go.sum ./ 
RUN go mod download

COPY . .

WORKDIR /app/web
RUN npm install

WORKDIR /app
ENV CHOKIDAR_USEPOLLING=1
ENV SHELL=/bin/sh
EXPOSE 8000 8001

# Run frontend dev server (http-server on 8001) + Tailwind watch, and Air for Go live reload.
CMD ["sh", "-c", "cd /app/web && npm run dev & cd /app && air -c air.toml"]
